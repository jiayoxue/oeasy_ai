// 添加了完整的错误处理链
async function loadHeatmapData() {
  try {
    const response = await fetch('location_counts.csv');
    // 状态码检查
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    
    // 数据处理流程
    const rawData = await response.text();
    const locationData = rawData
      .split('\n')
      .filter(row => row.trim())  // 过滤空行
      .slice(1)  // 跳过CSV标题行
      .map(row => {
        // 处理可能包含逗号的城市名
        const [province, ...valueParts] = row.split(',');
        const value = parseInt(valueParts.join('').trim());
        
        // 数据有效性验证
        if (!province || isNaN(value)) {
          console.warn('无效数据行:', row);
          return null;
        }
        
        return {
          name: province.trim().replace(/"/g, ''),
          value: value
        };
      })
      .filter(item => item !== null);
  } catch (error) {
    // 错误处理
    console.error('数据加载失败:', error);
    document.getElementById('heatmap-chart').innerHTML = 
      `<div style="color: red; text-align: center; padding: 20px;">
         热力图数据加载失败：${error.message}
       </div>`;
  }
}
